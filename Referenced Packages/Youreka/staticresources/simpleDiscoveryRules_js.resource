"use strict";function populatFormPicklists(){var o=$(".formLookup"),e=Object.keys(formFields2DiscoveryFields);e.forEach(function(e){var i='<option value="'+e+'">'+e+"</option>";o.append(i)})}function populateDiscoPicklists(o){var e=$(o).val(),i=formFields2DiscoveryFields[e],t=$(o).closest(".questionBox"),n=t.find(".discoLookup");void 0===i?(n.find(".discoOption").remove(),t.find(".disco-tooltip").hide(),t.find("p.after-picklist").removeClass("after-picklist-moved")):i.length?(n.find(".discoOption").remove(),i.forEach(function(o){var e="<option class='discoOption' value=\""+o+'">'+o+"</option>";n.append(e)}),t.find(".disco-tooltip").hide(),t.find("p.after-picklist").removeClass("after-picklist-moved")):(n.find(".discoOption").remove(),t.find(".disco-tooltip").show(),t.find("p.after-picklist").addClass("after-picklist-moved"))}function discoveryTypeAutoComplete(){$(".discoveryTypeInput").autocomplete({source:discoveryTypeOptions,select:function(o,e){o.preventDefault(),$(this).val(e.item.label),$(this).data("discoverytypesfid",e.item.value),$(this).attr("title",e.item.label)}})}function saveDiscoveryTypeSelections(o){function e(){this.id=null,this.Discovery_Type__c=null}function i(){this.id=null,this.Discovery_Field_For_Discovery__c=null,this.Discovery_Field_For_Form__c=null}$(".lookupErrorMsg").remove(),$(".lookupError").removeClass("lookupError");var t=[],n=[],l={};if($(".simpleDiscoveryQuestionBox").each(function(){var o=!0,s=$(this).attr("data-questionid"),r=$(this).find(".lookups"),c=r.find(".formLookup").val(),a=r.find(".discoLookup").val();$(this).find(".discoveryTypeInput").each(function(r){var u=new e;u.id=$(this).data("sfid");var d=$(this).data("discoverytypesfid"),p=$(this).val();(null===p||""===p)&&(p=null);var v=new i,f=$.grep(n,function(o){return o.id==s}),_=$.grep(n,function(o){return o.id==s&&null===o.Discovery_Field_For_Discovery__c?!0:void 0});if(null!==p&&null!==d){if(o=!1,u.Discovery_Type__c=d,(c===nullSelect||null===c||""===c)&&(c=null),(a===nullSelect||null===a||""===a)&&(a=null),v.id=s,v.Discovery_Field_For_Discovery__c=a,v.Discovery_Field_For_Form__c=c,!f.length||_.length)if(_.length)for(var y=0;y<n.length;y++)n[y].id===v.id&&(n.splice(y,1),n.push(v));else n.push(v);null!==c&&null===a&&(l[s]=[],l[s].push("discoLookup"))}else v.id=s,v.Discovery_Field_For_Discovery__c=null,v.Discovery_Field_For_Form__c=null,f.length||n.push(v),(c===nullSelect||null===c||""===c)&&(o=!1);console.log("Question Value: "+u),t.push(u)}),o&&(l.hasOwnProperty(s)?l[s].push("noDisco"):(l[s]=[],l[s].push("noDisco")))}),Object.keys(l).length){$("#fade").hide(),$("#savingStatus").hide();for(var s in l){var r,c="Please select ";for(r=0;r<l[s].length;r++){var a=l[s][r];c+=r>0?" and ":"",c+="noDisco"===a?"a Discovery Type for at least one question value":"formLookup"===a?"Form Lookup":"Discovery Lookup",$(".questionBox[data-questionid = "+s+"]").find("."+a).addClass("lookupError")}c+=".",$(".questionBox[data-questionid = "+s+"]").append("<p class=lookupErrorMsg>"+c+"</p>")}return l}$(".lookupErrorMsg").remove(),Visualforce.remoting.Manager.invokeAction(saveQuestionAndValues,t,n,function(e,i){l={},o()})}function updateTitle(o){$(o).attr("title")!=$(o).val()&&$(o).attr("title",$(o).val())}function showModal(o,e){o.fadeIn(),e.fadeIn()}function hideModal(o,e,i){o.fadeOut(),e.fadeOut(),"function"==typeof i&&i()}function nextPage(){window.top.location="/apex/TB_DiscoveryRules?templateId="+templateID}$(document).ready(function(){var o=namespace,e=$("#discoveryTypeModal"),i=$("#fade"),t=$("#savingStatus");$(".clearDiscoveryType").click(function(o){var e=$(this).parent().find(".discoveryTypeInput");console.log($(this).parent()),e.val(""),e.data("discoverytypesfid",""),o.preventDefault()}),$(document).tooltip({position:{my:"center bottom",at:"center top"}}),discoveryTypeAutoComplete(),$(".closeButton").click(function(o){hideModal(e,i),o.preventDefault()}),$("#back").click(function(o){window.top.location="/apex/TemplateBuilder?templateId="+templateID,o.preventDefault()}),$("#save").click(function(o){showModal(t,i),saveDiscoveryTypeSelections(function(){nextPage()}),o.preventDefault()}),populatFormPicklists(),$(".formLookup").change(function(){var o=this;populateDiscoPicklists(o)}),questionsWithDiscoveriesJSON.forEach(function(e){var i,t;e.hasOwnProperty(o+"Discovery_Field_For_Form__c")&&null!==e[o+"Discovery_Field_For_Form__c"]&&e.hasOwnProperty(o+"Discovery_Field_For_Discovery__c")&&null!==e[o+"Discovery_Field_For_Discovery__c"]&&(i=$("[data-questionid="+e.Id+"]"),t=i.find(".formLookup"),t.val(e[o+"Discovery_Field_For_Form__c"]),t.trigger("change"),i.find(".discoLookup").val(e[o+"Discovery_Field_For_Discovery__c"]))})});